# 🗣️ AI 대화 자연스럽게 개선하기

## 📋 개선 전 문제점

### 1. **너무 짧은 응답**
- 문제: "1-2문장만" 강제 → 대화가 불친절하고 끊김
- 예시: "좋아? → "응" → "그래?" (너무 건조함)

### 2. **엄격한 5턴 규칙**
- 문제: 정확히 5번 대화 후에만 추천
- 결과: 대화가 기계적이고 부자연스러움

### 3. **장소명 언급 금지**
- 문제: 추천 전까지 장소명 절대 금지
- 결과: "그곳", "거기" 같은 어색한 표현

### 4. **딱딱한 단계 구조**
- 문제: greeting → preference → recommendation 순서 강제
- 결과: 유연한 대화 흐름 불가능

---

## ✨ 개선 내용

### 1. **프롬프트 완전 개편**

#### 이전 (딱딱함)
```
[핵심 규칙 - 절대 지켜야 함]
- 한 번에 딱 1-2문장만 말하기 (절대 3문장 이상 금지)
- 최소 5번 티키타카 대화 후에 장소 추천
- 추천 전까지는 절대 구체적인 장소명 언급 금지
```

#### 개선 후 (자연스러움)
```
[대화 방식]
- 2-3문장 정도로 자연스럽게 대화
- 상대방 말에 공감하고 반응하면서 취향 파악
- "어떤 여행 좋아해?" 식으로 가볍게

[추천 타이밍]
- 3-4번 정도 대화 나누면서 취향 파악
- 충분히 파악되면 자연스럽게 장소 추천
- 대화 흐름상 적절한 타이밍에
```

### 2. **턴 제한 완화**

```javascript
// 이전: 5턴 이상
const canRecommend = session.conversationTurns >= 5;

// 개선: 3턴 이상 (더 빠르고 자연스러운 추천)
const canRecommend = session.conversationTurns >= 3;
```

**효과**:
- 사용자: "쇼핑 좋아해" → AI: "오 좋네!" → 사용자: "카페도 좋아" → **AI: "그럼 동성로 어때?"**
- 3-4턴이면 충분히 취향 파악 가능

### 3. **응답 길이 조정**

```javascript
// 이전: 1-2문장
max_tokens: 100,
temperature: 0.9,

// 개선: 2-3문장 (자연스러운 길이)
max_tokens: 200,
temperature: 0.85,
```

**예시**:
```
이전: "쇼핑 좋아해?"
개선: "쇼핑 좋아해? 옷 구경하는 거나 맛집 찾아다니는 것도 좋아하는 편이야?"
```

### 4. **단계별 메시지 유연화**

#### 초반 대화 (< 3턴)
```
이전:
- 동성로, 달성공원, 수성못 등 구체적인 장소명은 절대 언급 금지
- 딱 1-2문장으로만 응답 (절대 길게 말하지 않기)

개선:
- 자연스럽게 대화하면서 취향 파악
- "쇼핑 좋아해?", "조용한 곳 좋아해?" 같은 질문으로 취향 알아보기
- 2-3문장 정도로 편하게 대화
```

#### 추천 단계 (≥ 3턴)
```
이전:
- 딱 한 곳만 추천: 동성로
- 장소명 + 이유 한 마디만
- 딱 1-2문장으로만 응답

개선:
- 동성로 추천하기
- "이런 거 어때?" 식으로 부담 없이 제안
- 장소의 매력 포인트 2-3가지 자연스럽게 설명
- 예: "동성로 가볼래? 거기 분위기 좋아!"
```

### 5. **장소명 필터링 완화**

```javascript
// 이전: 5턴 미만일 때 모든 장소명 제거
if (currentTurns < 5) {
  // '동성로' → '그곳'으로 강제 변환
}

// 개선: 3턴 미만일 때만, 추천 단계는 제외
if (currentTurns < 3 && stage !== 'recommendation') {
  // 초반에만 필터링
}
// 3턴 이상이면 장소명 자연스럽게 사용 가능
```

---

## 📊 개선 효과 비교

### 대화 예시 1: 쇼핑 좋아하는 사용자

#### 이전 (기계적)
```
사용자: 안녕!
AI: 안녕! 뭐 하고 싶어?
사용자: 쇼핑 좋아해
AI: 좋지!
사용자: 맛집도 좋아해
AI: 오 그래?
사용자: 응
AI: 어떤 분위기 좋아해?
사용자: 활기찬 거
AI: 그곳 어때? [턴이 5번 안되서 장소명 못 말함]
```

#### 개선 후 (자연스러움)
```
사용자: 안녕!
AI: 안녕! 대구 와서 뭐 하고 싶어? 쇼핑이나 구경하는 것 좋아해?
사용자: 쇼핑 좋아해
AI: 오 좋네! 옷이나 악세사리 보는 거? 아니면 맛집 찾아다니는 것도 좋아해?
사용자: 둘 다 좋아!
AI: 그럼 딱이다! 동성로 가볼래? 거기 쇼핑도 할 수 있고 맛집도 많아. 젊은 사람들 많아서 분위기도 좋아!
```

### 대화 예시 2: 조용한 곳 선호하는 사용자

#### 이전 (건조함)
```
사용자: 조용한 곳 좋아해
AI: 그래?
사용자: 산책하고 싶어
AI: 좋지!
사용자: 자연도 좋아해
AI: 오케이
사용자: 힐링하고 싶어
AI: 그곳 어때? [5턴 후에도 어색]
```

#### 개선 후 (공감하며 자연스러움)
```
사용자: 조용한 곳 좋아해
AI: 아 조용한 거 좋아하는구나! 산책하거나 자연 보는 거 좋아해?
사용자: 응, 힐링하고 싶어
AI: 완전 공감! 달성공원 어때? 거기 가면 자연 속에서 여유롭게 산책할 수 있어. 사람도 별로 없고 힐링하기 딱 좋아!
```

---

## 🎯 핵심 개선 포인트

### 1. **응답 길이** 📏
- **1-2문장** → **2-3문장**
- 자연스러운 대화 흐름

### 2. **추천 타이밍** ⏱️
- **5턴 고정** → **3-4턴 유연**
- 흐름에 맞춰 자연스럽게

### 3. **톤 앤 매너** 💬
- **딱딱함** → **친근함**
- 공감하고 리액션 하는 스타일

### 4. **프롬프트 스타일** 📝
- **규칙 중심** → **대화 꿀팁 중심**
- "절대 금지"보다 "이렇게 하면 좋아"

### 5. **장소명 사용** 🗺️
- **초반부터 금지** → **3턴 후 자연스럽게 사용**
- 어색한 "그곳" 대신 실제 장소명

---

## 📈 예상 효과

### 사용자 경험 향상
- ✅ 대화가 자연스러워짐
- ✅ AI가 더 친근하게 느껴짐
- ✅ 정보 전달이 명확해짐
- ✅ 추천이 더 빨라짐 (3-4턴)

### 대화 품질 개선
- ✅ 공감 표현 증가
- ✅ 맥락 있는 대화
- ✅ 자연스러운 흐름
- ✅ 적절한 정보량

---

## 🔧 추가 개선 가능 사항 (선택적)

### 1. 개인화된 응답
```javascript
// 사용자 입력 패턴 분석
if (userMessage.includes('ㅋㅋ')) {
  // 좀 더 밝고 활발한 톤
}
```

### 2. 맥락 기반 추천
```javascript
// 이전 대화 내용 활용
if (previousMessages.includes('친구랑')) {
  // 단체 여행에 좋은 장소 우선 추천
}
```

### 3. 거절 시 대응
```javascript
if (userRejects) {
  // "아 그럼 이런 건 어때?" 식으로 자연스럽게 대안 제시
}
```

---

## 📝 개선 완료 체크리스트

- ✅ 프롬프트 메시지 재작성 (친근한 톤)
- ✅ 턴 제한 완화 (5턴 → 3턴)
- ✅ 응답 길이 조정 (100 → 200 tokens)
- ✅ Temperature 조정 (0.9 → 0.85)
- ✅ 장소명 필터링 완화 (3턴 이후 허용)
- ✅ 단계별 시스템 메시지 유연화

---

---

## 🔄 추가 조정 (2025년 11월 18일 - 오후)

### 문제점
사용자 피드백: "대화가 너무 길면 AI가 헛소리를 하던데 기존처럼 한두줄의 짧은 대답이 좋을 거같아"

### 원인 분석
- **max_tokens: 200** → GPT-3.5-turbo에서 hallucination 위험 증가
- **2-3문장 응답** → 불필요한 정보 추가, 사실과 다른 내용 생성 가능성
- **여행 가이드 특성**: 간결하고 정확한 정보 전달이 더 중요

### 균형잡힌 해결책
완전히 이전(100 tokens)으로 돌아가지 않고 **중간 지점** 채택:

```javascript
// 최종 설정
max_tokens: 120,  // 100과 200의 균형점
프롬프트: "1-2문장으로 짧고 명확하게"
temperature: 0.85  // 유지 (자연스러움)
턴 제한: 3턴  // 유지 (빠른 추천)
```

### 수정 내용
1. **max_tokens: 200 → 120**
   - 너무 짧지 않으면서도 헛소리 방지
   - 핵심 정보만 간결하게 전달

2. **프롬프트 수정**
   ```
   이전: "2-3문장 정도로 자연스럽게 대화"
   변경: "1-2문장으로 짧고 명확하게 대화 (간결함이 중요!)"
   ```

3. **모든 단계별 메시지 조정**
   - 초반 대화: "1-2문장으로 짧게 대화"
   - 장소 추천: "매력 포인트 1-2가지 간결하게 설명"
   - 추천 중: "1-2문장으로 간결하게 어필"
   - 도착 후: "1-2문장으로 간결하게 설명"

### 유지된 개선사항
✅ 친근한 톤과 말투 (카톡 스타일)
✅ 3턴 추천 타이밍 (5턴→3턴)
✅ 자연스러운 질문 방식
✅ 공감과 리액션

### 기대 효과
- ✅ **정확성 향상**: Hallucination 감소
- ✅ **가독성 향상**: 짧고 명확한 정보
- ✅ **참여도 유지**: 빠른 티키타카
- ✅ **자연스러움 유지**: 친근한 톤은 그대로

---

**업데이트**: 2025년 11월 18일
**목적**: AI 대화를 더 자연스럽고 친근하게 만들기 (오전)
**추가 조정**: 간결함과 정확성 우선, hallucination 방지 (오후)
